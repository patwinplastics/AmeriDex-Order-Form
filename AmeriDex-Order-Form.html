<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>AmeriDex Order Form Pro</title>
<style>
    :root {
        --bg-page: #f5f7fa;
        --bg-card: #ffffff;
        --primary: #2563eb;
        --primary-dark: #1d4ed8;
        --primary-soft: #eff6ff;
        --border-subtle: #e5e7eb;
        --text-main: #111827;
        --text-muted: #6b7280;
        --danger: #dc2626;
        --success: #16a34a;
        --warning: #f59e0b;
        --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.08);
        --radius-card: 14px;
        --radius-field: 8px;
        --safe-area-inset-bottom: env(safe-area-inset-bottom, 0);
    }

    * { box-sizing: border-box; }

    html, body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background-color: var(--bg-page);
        color: var(--text-main);
        line-height: 1.5;
    }

    body {
        -webkit-font-smoothing: antialiased;
        -webkit-tap-highlight-color: transparent;
    }

    .page-shell {
        max-width: 1120px;
        margin: 0 auto;
        padding: 0.75rem 0.75rem 3rem;
    }

    header.app-header {
        background: linear-gradient(135deg, #2563eb, #1e40af);
        color: #fff;
        padding: 1.5rem 1rem 1.75rem;
        border-radius: 0 0 var(--radius-card) var(--radius-card);
        box-shadow: var(--shadow-soft);
        text-align: center;
        position: sticky;
        top: 0;
        z-index: 5;
    }

    header.app-header img {
        max-width: 160px;
        height: auto;
        display: block;
        margin: 0 auto 0.5rem;
    }

    header.app-header h1 {
        margin: 0.15rem 0 0.3rem;
        font-size: 1.4rem;
        letter-spacing: 0.03em;
    }

    header.app-header p.header-sub {
        margin: 0.1rem 0 0;
        font-size: 0.75rem;
        color: rgba(249, 250, 251, 0.9);
        line-height: 1.3;
    }

    main { margin-top: 0.75rem; }

    .card {
        background: var(--bg-card);
        border-radius: var(--radius-card);
        padding: 1.25rem;
        margin-bottom: 0.9rem;
        box-shadow: 0 1px 3px rgba(15, 23, 42, 0.05);
        border: 1px solid rgba(148, 163, 184, 0.18);
    }

    .card-header {
        margin-bottom: 0.75rem;
        border-bottom: 1px solid rgba(229, 231, 235, 0.9);
        padding-bottom: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 0.5rem;
    }

    .card-title {
        margin: 0;
        font-size: 1rem;
        font-weight: 700;
        letter-spacing: 0.01em;
    }

    .card-subtitle {
        margin: 0.15rem 0 0;
        font-size: 0.75rem;
        color: var(--text-muted);
        line-height: 1.3;
    }

    .progress-badge {
        display: inline-block;
        background: var(--success);
        color: white;
        padding: 0.25rem 0.6rem;
        border-radius: 999px;
        font-size: 0.65rem;
        font-weight: 600;
        white-space: nowrap;
        flex-shrink: 0;
    }

    .progress-badge.incomplete {
        background: var(--warning);
    }

    .form-grid {
        display: grid;
        grid-template-columns: minmax(0, 1fr);
        gap: 0.7rem;
    }

    .field {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }

    .field-row-2 {
        display: grid;
        grid-template-columns: minmax(0, 1fr);
        gap: 0.7rem;
    }

    .field-row-3 {
        display: grid;
        grid-template-columns: minmax(0, 1fr);
        gap: 0.7rem;
    }

    .field-row-4 {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 0.7rem;
    }

    @media (min-width: 768px) {
        .field-row-2 {
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
        }
        .field-row-3 {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }
        .field-row-4 {
            grid-template-columns: repeat(4, minmax(0, 1fr));
        }
    }

    label {
        font-size: 0.85rem;
        font-weight: 600;
        color: #374151;
    }

    .required-indicator {
        color: var(--danger);
        margin-left: 0.1rem;
    }

    .help-text {
        font-size: 0.7rem;
        color: var(--text-muted);
        margin-top: 0.15rem;
        line-height: 1.3;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    input[type="date"],
    textarea,
    select {
        width: 100%;
        padding: 0.75rem 0.6rem;
        border-radius: var(--radius-field);
        border: 1px solid var(--border-subtle);
        font-size: 1rem;
        color: var(--text-main);
        background-color: #ffffff;
        transition: border-color 0.12s ease, box-shadow 0.12s ease, background-color 0.12s ease;
        appearance: none;
        -webkit-appearance: none;
    }

    select {
        padding-right: 2.5rem;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23111827' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.6rem center;
        background-size: 1.2rem;
    }

    input:focus,
    textarea:focus,
    select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
        background-color: #f9fafb;
    }

    textarea {
        min-height: 80px;
        resize: vertical;
        font-family: inherit;
    }

    .error {
        font-size: 0.7rem;
        color: var(--danger);
        margin-top: 0.1rem;
    }

    .hint {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 0.1rem;
        line-height: 1.4;
    }

    .inline-checks {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        margin-bottom: 0.6rem;
    }

    .check-row {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        padding: 0.4rem 0;
    }

    .check-row input[type="checkbox"] {
        width: 18px;
        height: 18px;
        margin-top: 0.15rem;
        cursor: pointer;
        flex-shrink: 0;
    }

    .check-row label {
        margin: 0;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        flex: 1;
    }

    .note-inline {
        margin-left: 2rem;
        font-size: 0.75rem;
        color: #b45309;
        line-height: 1.3;
    }

    /* 3D Deck Builder Styles */
    .deck-builder-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    @media (min-width: 992px) {
        .deck-builder-container {
            grid-template-columns: 320px 1fr;
        }
    }

    .builder-controls {
        background: #f9fafb;
        border-radius: 10px;
        padding: 1rem;
        border: 1px solid var(--border-subtle);
    }

    .builder-controls h3 {
        margin: 0 0 0.75rem 0;
        font-size: 0.9rem;
        color: var(--primary);
        border-bottom: 1px solid var(--border-subtle);
        padding-bottom: 0.5rem;
    }

    .control-section {
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px dashed var(--border-subtle);
    }

    .control-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .control-section-title {
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .builder-viewport {
        position: relative;
        background: linear-gradient(180deg, #87CEEB 0%, #E0F4FF 50%, #90EE90 100%);
        border-radius: 10px;
        overflow: hidden;
        min-height: 400px;
        border: 2px solid var(--border-subtle);
    }

    @media (min-width: 768px) {
        .builder-viewport {
            min-height: 500px;
        }
    }

    #deck-canvas {
        width: 100%;
        height: 100%;
        display: block;
    }

    .viewport-controls {
        position: absolute;
        bottom: 10px;
        left: 10px;
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .viewport-btn {
        background: rgba(255,255,255,0.95);
        border: 1px solid var(--border-subtle);
        border-radius: 6px;
        padding: 0.4rem 0.7rem;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.15s ease;
        font-weight: 600;
    }

    .viewport-btn:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .viewport-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .material-summary {
        background: white;
        border-radius: 8px;
        padding: 0.75rem;
        margin-top: 0.75rem;
        border: 1px solid var(--border-subtle);
    }

    .material-summary h4 {
        margin: 0 0 0.5rem 0;
        font-size: 0.85rem;
        color: var(--primary-dark);
    }

    .material-item {
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
        padding: 0.25rem 0;
        border-bottom: 1px dotted var(--border-subtle);
    }

    .material-item:last-child {
        border-bottom: none;
    }

    .material-item-label {
        color: var(--text-muted);
    }

    .material-item-value {
        font-weight: 600;
    }

    .color-swatches {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0.4rem;
        margin-top: 0.5rem;
    }

    .color-swatch {
        aspect-ratio: 1;
        border-radius: 6px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.15s ease;
        position: relative;
    }

    .color-swatch:hover {
        transform: scale(1.1);
    }

    .color-swatch.selected {
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
    }

    .color-swatch::after {
        content: attr(data-name);
        position: absolute;
        bottom: -18px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.6rem;
        white-space: nowrap;
        color: var(--text-muted);
    }

    .stair-config {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
    }

    .stair-side-btn {
        padding: 0.5rem;
        font-size: 0.75rem;
        border: 1px solid var(--border-subtle);
        background: white;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.15s ease;
    }

    .stair-side-btn:hover {
        border-color: var(--primary);
    }

    .stair-side-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .stair-side-btn.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .apply-btn {
        width: 100%;
        margin-top: 1rem;
        background: var(--success);
        color: white;
        border: none;
        padding: 0.75rem;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.15s ease;
    }

    .apply-btn:hover {
        background: #15803d;
    }

    .reset-builder-btn {
        width: 100%;
        margin-top: 0.5rem;
        background: transparent;
        color: var(--text-muted);
        border: 1px solid var(--border-subtle);
        padding: 0.5rem;
        border-radius: 6px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.15s ease;
    }

    .reset-builder-btn:hover {
        border-color: var(--danger);
        color: var(--danger);
    }

    /* Loading overlay */
    .builder-loading {
        position: absolute;
        inset: 0;
        background: rgba(255,255,255,0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 1rem;
        z-index: 10;
    }

    .builder-loading.hidden {
        display: none;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid var(--border-subtle);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Mobile Color Grid */
    .color-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
        gap: 0.6rem;
        margin-top: 0.75rem;
        margin-bottom: 0.75rem;
    }

    @media (min-width: 768px) {
        .color-grid {
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
        }
    }

    .color-card {
        border: 2px solid transparent;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
    }

    .color-card:active {
        transform: scale(0.95);
    }

    .color-card:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
    }

    .color-card.selected {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
    }

    .color-card img {
        width: 100%;
        height: 60px;
        object-fit: cover;
        border-radius: 6px;
        display: block;
    }

    .color-card-label {
        text-align: center;
        font-size: 0.7rem;
        font-weight: 600;
        margin-top: 0.3rem;
        color: var(--text-main);
    }

    /* Mobile Comparison Panel */
    .comparison-panel {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-top: 1rem;
        padding: 0.75rem;
        background: #f9fafb;
        border-radius: 10px;
    }

    @media (min-width: 768px) {
        .comparison-panel {
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            padding: 1rem;
        }
    }

    .color-preview {
        text-align: center;
    }

    .color-preview h4 {
        margin: 0 0 0.5rem 0;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .color-preview img {
        width: 100%;
        max-width: 150px;
        border-radius: 8px;
        border: 1px solid var(--border-subtle);
    }

    /* Mobile Line Items Card Layout */
    .line-item-card {
        background: white;
        border: 1px solid var(--border-subtle);
        border-radius: 10px;
        padding: 0.9rem;
        margin-bottom: 0.8rem;
        display: none;
    }

    .line-item-card.mobile-visible {
        display: block;
    }

    .line-item-card h4 {
        margin: 0 0 0.75rem 0;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--primary);
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--border-subtle);
    }

    .line-item-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.6rem;
        margin-bottom: 0.6rem;
    }

    .line-item-row.full {
        grid-template-columns: 1fr;
    }

    .line-item-row > div {
        display: flex;
        flex-direction: column;
    }

    .line-item-row label {
        font-size: 0.8rem;
        margin-bottom: 0.3rem;
    }

    .line-item-subtotal {
        background: #f9fafb;
        padding: 0.6rem;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--primary-dark);
        text-align: right;
    }

    .line-item-card-actions {
        display: flex;
        gap: 0.4rem;
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 1px solid var(--border-subtle);
    }

    .line-item-card-actions button {
        flex: 1;
    }

    @media (max-width: 768px) {
        #line-items {
            display: none;
        }
    }

    @media (min-width: 769px) {
        .line-item-card {
            display: none !important;
        }
        #mobile-items-container {
            display: none !important;
        }
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 0.75rem;
        font-size: 0.85rem;
    }

    thead { background-color: #f9fafb; }

    th,
    td {
        border: 1px solid var(--border-subtle);
        padding: 0.5rem;
        vertical-align: middle;
    }

    th {
        font-weight: 600;
        color: #4b5563;
        text-align: left;
        font-size: 0.8rem;
    }

    th.numeric,
    td.numeric {
        text-align: right;
    }

    td input,
    td select {
        font-size: 0.8rem;
        padding: 0.35rem 0.4rem;
        border-radius: 6px;
    }

    td .qty-input { max-width: 60px; }
    td .len-input { max-width: 80px; }
    td .price-input { max-width: 120px; }

    .preview-img {
        width: 30px;
        height: 30px;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
        margin-left: 0.4rem;
        border: 1px solid #e5e7eb;
        background-color: #f9fafb;
    }

    .table-actions-cell {
        text-align: center;
        width: 35px;
    }

    .btn-remove-row {
        background-color: #fee2e2;
        color: #b91c1c;
        border-radius: 999px;
        border: none;
        padding: 0.25rem 0.6rem;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.12s ease;
        min-height: 32px;
    }

    .btn-remove-row:active { background-color: #fca5a5; }
    .btn-remove-row:hover { background-color: #fecaca; }

    .btn-undo {
        background-color: #fef3c7;
        color: #92400e;
        border-radius: 999px;
        border: none;
        padding: 0.4rem 0.9rem;
        font-size: 0.8rem;
        cursor: pointer;
        margin-top: 0.5rem;
        font-weight: 600;
        width: 100%;
        transition: all 0.12s ease;
        min-height: 40px;
    }

    .btn-undo:active { background-color: #fcd34d; }
    .btn-undo:hover { background-color: #fed7aa; }

    .btn-add-row {
        margin-top: 0.75rem;
        font-size: 0.85rem;
        padding-inline: 0.8rem;
        width: 100%;
        min-height: 40px;
    }

    /* Sticky Price Bar - Mobile Bottom */
    .sticky-price-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, rgba(255,255,255,0) 0%, #ffffff 20%);
        padding: 0.5rem 0.75rem var(--safe-area-inset-bottom);
        border-top: 2px solid var(--border-subtle);
        z-index: 10;
        display: none;
    }

    .sticky-price-bar.mobile-visible {
        display: block;
    }

    .sticky-price-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
        padding: 0.5rem 0.75rem;
        border-radius: 8px;
        box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
    }

    .sticky-label {
        font-size: 0.8rem;
        color: var(--text-muted);
        font-weight: 600;
    }

    .sticky-value {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--primary-dark);
    }

    .total-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0.9rem;
        border-radius: var(--radius-card);
        background: #f9fafb;
        border: 1px solid var(--border-subtle);
        gap: 1rem;
    }

    .total-label {
        font-size: 0.85rem;
        color: #4b5563;
        font-weight: 600;
    }

    .total-value {
        font-size: 1.15rem;
        font-weight: 700;
        color: #1e40af;
    }

    .fastener-block {
        margin-top: 0.75rem;
        padding: 0.6rem;
        background-color: var(--primary-soft);
        border-radius: 10px;
        border: 1px dashed #bfdbfe;
        font-size: 0.8rem;
        color: #1d4ed8;
        line-height: 1.4;
    }

    .fastener-warning {
        color: #b91c1c;
        font-size: 0.75rem;
        margin-top: 0.35rem;
        line-height: 1.3;
    }

    .actions-row {
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
        margin-bottom: 2.5rem;
    }

    @media (min-width: 768px) {
        .actions-row {
            flex-direction: row;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 0;
        }
    }

    .btn {
        border-radius: 8px;
        padding: 0.75rem 1.2rem;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        border: 1px solid transparent;
        transition: all 0.12s ease;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    @media (max-width: 768px) {
        .btn {
            width: 100%;
            min-height: 48px;
            font-size: 0.95rem;
        }
    }

    .btn-primary {
        background-color: var(--primary);
        color: #ffffff;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }

    .btn-primary:active { background-color: #1e40af; }
    .btn-primary:hover { background-color: var(--primary-dark); }

    .btn-outline {
        background-color: #ffffff;
        color: var(--primary);
        border-color: var(--primary);
    }

    .btn-outline:active { background-color: #f0f7ff; }
    .btn-outline:hover { background-color: #eff6ff; }

    .btn-ghost {
        background-color: transparent;
        color: #374151;
        border-color: #d1d5db;
    }

    .btn-ghost:active { background-color: #f3f4f6; }
    .btn-ghost:hover { background-color: #f9fafb; }

    .btn-sm {
        padding: 0.35rem 0.65rem;
        font-size: 0.75rem;
        min-height: auto;
    }

    .success-banner {
        margin-top: 0.6rem;
        padding: 0.5rem 0.75rem;
        border-radius: 10px;
        background-color: #ecfdf3;
        color: #166534;
        font-size: 0.8rem;
        border: 1px solid #bbf7d0;
        line-height: 1.4;
    }

    .modal {
        display: none;
        position: fixed;
        inset: 0;
        background-color: rgba(15, 23, 42, 0.55);
        z-index: 50;
        justify-content: center;
        align-items: center;
        padding: 0.75rem;
        overflow-y: auto;
        padding-bottom: var(--safe-area-inset-bottom);
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: #ffffff;
        padding: 1rem;
        border-radius: 12px;
        max-width: 95%;
        max-height: 90vh;
        position: relative;
        box-shadow: var(--shadow-soft);
        overflow-y: auto;
        text-align: center;
    }

    .modal-content img {
        max-width: 100%;
        max-height: 60vh;
        border-radius: 10px;
    }

    .modal-close {
        position: absolute;
        top: 8px;
        right: 8px;
        font-size: 1.5rem;
        cursor: pointer;
        color: #6b7280;
        background: none;
        border: none;
        padding: 0.4rem;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.12s ease;
    }

    .modal-close:active { color: #374151; }
    .modal-close:hover { color: #111827; }

    .review-modal-content {
        text-align: left;
        max-width: 600px;
    }

    .review-section {
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border-subtle);
    }

    .review-section h3 {
        margin: 0 0 0.6rem 0;
        font-size: 0.95rem;
        color: var(--primary);
    }

    .review-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.4rem;
        font-size: 0.85rem;
        gap: 0.5rem;
    }

    .review-item-label {
        color: var(--text-muted);
        font-weight: 600;
        flex-shrink: 0;
    }

    .review-total {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--primary-dark);
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 2px solid var(--primary);
    }

    footer.app-footer {
        text-align: center;
        padding: 1rem 0.75rem 0.5rem;
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    footer.app-footer a {
        color: var(--primary);
        text-decoration: none;
    }

    footer.app-footer a:hover { text-decoration: underline; }

    @media (min-width: 769px) {
        .page-shell { padding: 1.5rem 1.25rem 2.5rem; }
        header.app-header { padding: 2.4rem 1.75rem 2.6rem; }
        header.app-header img { max-width: 220px; margin: 0 auto 0.75rem; }
        header.app-header h1 { font-size: 1.9rem; }
        header.app-header p.header-sub { font-size: 0.88rem; }
        .card { padding: 1.75rem; margin-bottom: 1.25rem; }
        .btn { width: auto; min-height: 40px; }
        .actions-row { flex-direction: row; justify-content: center; }
        .sticky-price-bar { display: none !important; }

        #line-items th:nth-child(1),
        #line-items td:nth-child(1) { width: 30%; }
        #line-items th:nth-child(2),
        #line-items td:nth-child(2) { width: 16%; }
        #line-items th:nth-child(3),
        #line-items td:nth-child(3) { width: 12%; }
        #line-items th:nth-child(4),
        #line-items td:nth-child(4) { width: 10%; }
        #line-items th:nth-child(5),
        #line-items td:nth-child(5) { width: 18%; }
        #line-items th:nth-child(6),
        #line-items td:nth-child(6) { width: 10%; }
        #line-items th:nth-child(7),
        #line-items td:nth-child(7) { width: 4%; }
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

<div class="page-shell">
    <header class="app-header">
        <img src="colors/AmeriDex.png" alt="AmeriDex Logo">
        <h1>AmeriDex Order Form Pro</h1>
        <p class="header-sub">
            AmeriDex System Boards include integrated Dexerdry. Standalone Dexerdry for non-system applications.
        </p>
    </header>

    <main>
        <form id="order-form">

            <!-- 3D Deck Builder Section -->
            <section class="card" id="deck-builder-section">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">3D Deck Builder</h2>
                        <p class="card-subtitle">Design your deck in 3D. Drag to rotate, scroll to zoom, right-click to pan.</p>
                    </div>
                </div>

                <div class="deck-builder-container">
                    <!-- Controls Panel -->
                    <div class="builder-controls">
                        <h3>Deck Configuration</h3>

                        <div class="control-section">
                            <div class="control-section-title">Dimensions</div>
                            <div class="field" style="margin-bottom: 0.5rem;">
                                <label for="builder-length">Length (ft)</label>
                                <input type="number" id="builder-length" value="16" min="4" max="40" step="1">
                            </div>
                            <div class="field" style="margin-bottom: 0.5rem;">
                                <label for="builder-width">Width (ft)</label>
                                <input type="number" id="builder-width" value="12" min="4" max="30" step="1">
                            </div>
                            <div class="field">
                                <label for="builder-height">Height from Ground (ft)</label>
                                <input type="number" id="builder-height" value="3" min="1" max="12" step="0.5">
                            </div>
                        </div>

                        <div class="control-section">
                            <div class="control-section-title">Board Color</div>
                            <div class="color-swatches" id="builder-color-swatches"></div>
                        </div>

                        <div class="control-section">
                            <div class="control-section-title">Board Length</div>
                            <div class="field">
                                <select id="builder-board-length">
                                    <option value="12">12 ft boards</option>
                                    <option value="16" selected>16 ft boards</option>
                                    <option value="20">20 ft boards</option>
                                </select>
                            </div>
                        </div>

                        <div class="control-section">
                            <div class="control-section-title">Stairs</div>
                            <div class="stair-config">
                                <button type="button" class="stair-side-btn" data-side="front">Front</button>
                                <button type="button" class="stair-side-btn" data-side="back">Back</button>
                                <button type="button" class="stair-side-btn" data-side="left">Left</button>
                                <button type="button" class="stair-side-btn" data-side="right">Right</button>
                            </div>
                            <div class="field" style="margin-top: 0.5rem;">
                                <label for="stair-width">Stair Width (ft)</label>
                                <input type="number" id="stair-width" value="4" min="3" max="8" step="0.5">
                            </div>
                        </div>

                        <div class="control-section">
                            <div class="control-section-title">Options</div>
                            <div class="check-row">
                                <input type="checkbox" id="builder-railing">
                                <label for="builder-railing">Add Railing</label>
                            </div>
                            <div class="check-row">
                                <input type="checkbox" id="builder-picture-frame">
                                <label for="builder-picture-frame">Picture Frame Border</label>
                            </div>
                        </div>

                        <div class="material-summary" id="material-summary">
                            <h4>Materials Estimate</h4>
                            <div class="material-item">
                                <span class="material-item-label">Deck Boards:</span>
                                <span class="material-item-value" id="est-boards">0</span>
                            </div>
                            <div class="material-item">
                                <span class="material-item-label">Border Boards:</span>
                                <span class="material-item-value" id="est-border">0</span>
                            </div>
                            <div class="material-item">
                                <span class="material-item-label">Stair Treads:</span>
                                <span class="material-item-value" id="est-stairs">0</span>
                            </div>
                            <div class="material-item">
                                <span class="material-item-label">Screw Boxes:</span>
                                <span class="material-item-value" id="est-screws">0</span>
                            </div>
                            <div class="material-item" style="border-top: 1px solid var(--border-subtle); padding-top: 0.5rem; margin-top: 0.25rem;">
                                <span class="material-item-label">Est. Total:</span>
                                <span class="material-item-value" id="est-total" style="color: var(--primary-dark);">$0.00</span>
                            </div>
                        </div>

                        <button type="button" class="apply-btn" id="apply-to-order">Apply to Order Form</button>
                        <button type="button" class="reset-builder-btn" id="reset-builder">Reset Builder</button>
                    </div>

                    <!-- 3D Viewport -->
                    <div class="builder-viewport" id="builder-viewport">
                        <div class="builder-loading" id="builder-loading">
                            <div class="spinner"></div>
                            <span>Loading 3D Builder...</span>
                        </div>
                        <canvas id="deck-canvas"></canvas>
                        <div class="viewport-controls">
                            <button type="button" class="viewport-btn" id="view-top">Top</button>
                            <button type="button" class="viewport-btn" id="view-front">Front</button>
                            <button type="button" class="viewport-btn" id="view-side">Side</button>
                            <button type="button" class="viewport-btn active" id="view-3d">3D</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Customer -->
            <section class="card" id="customer">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">Customer Information</h2>
                        <p class="card-subtitle">Who we're shipping to and contact details.</p>
                    </div>
                    <span class="progress-badge incomplete" id="cust-badge">0/4</span>
                </div>

                <div class="form-grid">
                    <div class="field-row-2">
                        <div class="field">
                            <label for="cust-name">Name<span class="required-indicator">*</span></label>
                            <input type="text" id="cust-name" required>
                            <div class="error" id="err-name"></div>
                        </div>
                        <div class="field">
                            <label for="cust-company">Company</label>
                            <input type="text" id="cust-company">
                            <div class="error" id="err-company"></div>
                        </div>
                    </div>

                    <div class="field">
                        <label for="cust-address">Address<span class="required-indicator">*</span></label>
                        <textarea id="cust-address" rows="3" required></textarea>
                        <div class="error" id="err-address"></div>
                    </div>

                    <div class="field-row-2">
                        <div class="field">
                            <label for="cust-phone">Phone<span class="required-indicator">*</span></label>
                            <input type="tel" id="cust-phone" required inputmode="tel">
                            <div class="error" id="err-phone"></div>
                        </div>
                        <div class="field">
                            <label for="cust-email">Email<span class="required-indicator">*</span></label>
                            <input type="email" id="cust-email" required inputmode="email">
                            <div class="error" id="err-email"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Order -->
            <section class="card" id="order">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">Order Details</h2>
                        <p class="card-subtitle">Products and special requirements.</p>
                    </div>
                </div>

                <div class="inline-checks">
                    <div class="check-row">
                        <input type="checkbox" id="pic-frame">
                        <label for="pic-frame">Picture Framing</label>
                    </div>
                    <div id="pic-frame-note" class="note-inline" style="display:none;">Add Solid Edge boards to frame the deck perimeter.</div>

                    <div class="check-row" style="margin-top:0.2rem;">
                        <input type="checkbox" id="stairs">
                        <label for="stairs">Stairs</label>
                    </div>
                    <div id="stairs-note" class="note-inline" style="display:none;">Add Solid Edge boards for stair treads and risers.</div>
                </div>

                <div id="fastener-hint" class="fastener-block" style="display:none;"></div>

                <!-- Desktop Table View -->
                <div id="desktop-table-container">
                    <table id="line-items">
                        <thead>
                        <tr>
                            <th>Product</th>
                            <th>Color</th>
                            <th>Length (ft)</th>
                            <th class="numeric">Qty</th>
                            <th class="numeric">Unit Price</th>
                            <th class="numeric">Subtotal</th>
                            <th class="table-actions-cell"></th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <!-- Mobile Card View -->
                <div id="mobile-items-container"></div>

                <button type="button" class="btn btn-outline btn-add-row" id="add-row">+ Add Line Item</button>

                <!-- Undo Button -->
                <button type="button" class="btn-undo" id="undo-btn" style="display:none;">Undo Last Deletion</button>

                <div style="margin-top:1rem;" class="form-grid">
                    <div class="field">
                        <label for="special-instr">Special Instructions / Notes for Production</label>
                        <textarea id="special-instr" rows="3"></textarea>
                    </div>
                    <div class="field">
                        <label for="internal-notes">Internal Sales Rep Notes</label>
                        <textarea id="internal-notes" rows="2"></textarea>
                    </div>
                </div>
            </section>

            <!-- Shipping -->
            <section class="card">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">Shipping & Delivery</h2>
                        <p class="card-subtitle">Only if different from customer information.</p>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="field">
                        <label for="ship-addr">Shipping Address (if different)</label>
                        <textarea id="ship-addr" rows="3"></textarea>
                    </div>
                    <div class="field">
                        <label for="del-date">Preferred Delivery Date</label>
                        <input type="date" id="del-date">
                    </div>
                </div>
            </section>

            <!-- Total -->
            <section class="card">
                <div class="total-bar">
                    <span class="total-label">Estimated Total</span>
                    <span class="total-value" id="grand-total">$0.00</span>
                </div>
            </section>

            <!-- Actions -->
            <section class="card" style="text-align:center;">
                <div class="actions-row">
                    <button type="button" class="btn btn-ghost" id="reset">Reset Form</button>
                    <button type="button" class="btn btn-outline" id="pdf">Export PDF</button>
                    <button type="button" class="btn btn-primary" id="review-btn">Review Order</button>
                </div>
                <div id="success-msg" class="success-banner" style="display:none;">
                    Order email prepared. Remember to attach any files in your email client before sending.
                </div>
            </section>
        </form>
    </main>

    <!-- Sticky Price Bar (Mobile) -->
    <div class="sticky-price-bar mobile-visible" id="sticky-price">
        <div class="sticky-price-content">
            <span class="sticky-label">Order Total</span>
            <span class="sticky-value" id="sticky-total">$0.00</span>
        </div>
    </div>

    <!-- Color Preview Modal -->
    <div id="colorModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="colorName">
        <div class="modal-content">
            <button type="button" class="modal-close" id="modal-close" aria-label="Close">&times;</button>
            <img id="colorLarge" src="" alt="Color Preview">
            <div id="colorName" style="margin-top:0.75rem;font-weight:600;"></div>
        </div>
    </div>

    <!-- Order Review Modal -->
    <div id="reviewModal" class="modal" role="dialog" aria-modal="true">
        <div class="modal-content review-modal-content">
            <button type="button" class="modal-close" id="review-close" aria-label="Close">&times;</button>
            <h2 style="margin-top: 0; color: var(--primary); font-size: 1.1rem;">Review Your Order</h2>

            <div class="review-section">
                <h3>Customer Details</h3>
                <div class="review-item">
                    <span class="review-item-label">Name:</span>
                    <span id="review-name"></span>
                </div>
                <div class="review-item">
                    <span class="review-item-label">Email:</span>
                    <span id="review-email"></span>
                </div>
                <div class="review-item">
                    <span class="review-item-label">Phone:</span>
                    <span id="review-phone"></span>
                </div>
            </div>

            <div class="review-section">
                <h3>Line Items</h3>
                <div id="review-items"></div>
            </div>

            <div class="review-section">
                <div class="review-total">
                    Estimated Total: <span id="review-total">$0.00</span>
                </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-top: 1rem;">
                <button type="button" class="btn btn-primary" id="review-submit">Proceed to Email</button>
                <button type="button" class="btn btn-ghost" id="review-back">Back to Edit</button>
            </div>
        </div>
    </div>

    <footer class="app-footer">
        <a href="http://www.ameridex.com" target="_blank">www.ameridex.com</a>
    </footer>
</div>

<script>
// ============================================
// PRODUCT CONFIGURATION
// ============================================
const PRODUCT_CONFIG = {
    categories: {
        decking: {
            label: "Decking Boards",
            products: {
                system: {
                    name: "AmeriDex System Boards (Grooved + Dexerdry included)",
                    price: 8.00,
                    isFt: true,
                    hasColor: true,
                    help: "Our premium option includes both grooved boards and integrated Dexerdry sealing."
                },
                grooved: {
                    name: "Grooved Deck Boards (no Dexerdry)",
                    price: 6.00,
                    isFt: true,
                    hasColor: true,
                    help: "Grooved boards without integrated sealing."
                },
                solid: {
                    name: "Solid Edge Deck Boards",
                    price: 6.00,
                    isFt: true,
                    hasColor: true,
                    help: "Use for picture framing or stair construction."
                }
            }
        },
        sealing: {
            label: "Sealing & Protection",
            products: {
                dexerdry: {
                    name: "Dexerdry Seals (standalone)",
                    price: 2.00,
                    isFt: true,
                    hasColor: false,
                    help: "Standalone sealing product."
                }
            }
        },
        fasteners: {
            label: "Fasteners & Hardware",
            products: {
                screws: {
                    name: "Epoxy-Coated Screws",
                    price: 37,
                    isFt: false,
                    hasColor: false,
                    help: "Per box (375 screws)."
                },
                plugs: {
                    name: "Color-Matching Plugs",
                    price: 33.79,
                    isFt: false,
                    hasColor: false,
                    help: "Per box."
                }
            }
        },
        custom: {
            label: "Custom Items",
            products: {
                custom: {
                    name: "Custom / Manual Item",
                    price: 0,
                    isFt: false,
                    hasColor: false,
                    help: "Add any custom product."
                }
            }
        }
    }
};

const PRODUCTS = {};
Object.values(PRODUCT_CONFIG.categories).forEach(cat => {
    Object.assign(PRODUCTS, cat.products);
});

const COLORS = ["Driftwood", "Khaki", "Slate", "Beachwood", "Chestnut", "Redwood", "Hazelnut"];

const COLOR_HEX = {
    Driftwood: 0xA89F91,
    Khaki: 0xC2B280,
    Slate: 0x708090,
    Beachwood: 0xD4C4A8,
    Chestnut: 0x954535,
    Redwood: 0xA45A52,
    Hazelnut: 0x8E7618
};

const COLOR_IMAGES = {
    Driftwood: "Driftwood.png",
    Khaki: "Khaki.png",
    Slate: "Slate.png",
    Beachwood: "Beachwood.png",
    Chestnut: "Chestnut.png",
    Redwood: "Redwood.png",
    Hazelnut: "Hazelnut.png"
};

// Constants
const BOARD_WIDTH_INCH = 5.5;
const BOARD_THICKNESS_INCH = 1;
const GAP_INCH = 0.125;
const EFFECTIVE_WIDTH_FT = (BOARD_WIDTH_INCH + GAP_INCH) / 12;
const WASTE_FACTOR = 1.10;
const SCREWS_PER_BOX = 375;
const SCREWS_PER_SQFT = 2;

// ============================================
// STATE
// ============================================
let lineItems = [];
let deletedItems = [];
let selectedColor1 = "Driftwood";

// 3D Builder State
let builderState = {
    length: 16,
    width: 12,
    height: 3,
    color: "Driftwood",
    boardLength: 16,
    stairs: { front: false, back: false, left: false, right: false },
    stairWidth: 4,
    railing: false,
    pictureFrame: false
};

// Three.js globals
let scene, camera, renderer, controls;
let deckGroup, groundMesh;
let animationId;

// ============================================
// THREE.JS 3D DECK BUILDER
// ============================================
function initThreeJS() {
    const container = document.getElementById('builder-viewport');
    const canvas = document.getElementById('deck-canvas');

    // Scene
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);

    // Camera
    const aspect = container.clientWidth / container.clientHeight;
    camera = new THREE.PerspectiveCamera(45, aspect, 0.1, 1000);
    camera.position.set(25, 20, 25);
    camera.lookAt(0, 0, 0);

    // Renderer
    renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;

    // Orbit Controls
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.minDistance = 5;
    controls.maxDistance = 100;
    controls.maxPolarAngle = Math.PI / 2 - 0.05;

    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);

    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(20, 30, 20);
    directionalLight.castShadow = true;
    directionalLight.shadow.mapSize.width = 2048;
    directionalLight.shadow.mapSize.height = 2048;
    directionalLight.shadow.camera.near = 0.5;
    directionalLight.shadow.camera.far = 100;
    directionalLight.shadow.camera.left = -30;
    directionalLight.shadow.camera.right = 30;
    directionalLight.shadow.camera.top = 30;
    directionalLight.shadow.camera.bottom = -30;
    scene.add(directionalLight);

    const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);
    fillLight.position.set(-10, 10, -10);
    scene.add(fillLight);

    // Ground
    createGround();

    // Deck Group
    deckGroup = new THREE.Group();
    scene.add(deckGroup);

    // Build initial deck
    buildDeck();

    // Hide loading
    document.getElementById('builder-loading').classList.add('hidden');

    // Animation loop
    animate();

    // Handle resize
    window.addEventListener('resize', onWindowResize);
}

function createGround() {
    // Grass ground
    const groundGeometry = new THREE.PlaneGeometry(100, 100);
    const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x7CBA5F });
    groundMesh = new THREE.Mesh(groundGeometry, groundMaterial);
    groundMesh.rotation.x = -Math.PI / 2;
    groundMesh.position.y = 0;
    groundMesh.receiveShadow = true;
    scene.add(groundMesh);

    // Grid helper (subtle)
    const gridHelper = new THREE.GridHelper(100, 100, 0x6AAF4F, 0x6AAF4F);
    gridHelper.position.y = 0.01;
    gridHelper.material.opacity = 0.2;
    gridHelper.material.transparent = true;
    scene.add(gridHelper);
}

function buildDeck() {
    // Clear existing deck
    while (deckGroup.children.length > 0) {
        deckGroup.remove(deckGroup.children[0]);
    }

    const { length, width, height, color, boardLength, stairs, stairWidth, railing, pictureFrame } = builderState;

    const boardColor = COLOR_HEX[color] || 0xA89F91;
    const boardWidthFt = BOARD_WIDTH_INCH / 12;
    const boardThicknessFt = BOARD_THICKNESS_INCH / 12;
    const gapFt = GAP_INCH / 12;

    // Create wood material with grain texture simulation
    const deckMaterial = new THREE.MeshLambertMaterial({ color: boardColor });
    const frameMaterial = new THREE.MeshLambertMaterial({ color: boardColor });
    const supportMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
    const railMaterial = new THREE.MeshLambertMaterial({ color: 0x444444 });

    // Support posts
    const postPositions = [];
    const postSpacing = 6; // feet
    for (let x = 0; x <= length; x += postSpacing) {
        for (let z = 0; z <= width; z += postSpacing) {
            postPositions.push({ x: x - length/2, z: z - width/2 });
        }
    }

    postPositions.forEach(pos => {
        const postGeometry = new THREE.BoxGeometry(0.33, height, 0.33);
        const post = new THREE.Mesh(postGeometry, supportMaterial);
        post.position.set(pos.x, height / 2, pos.z);
        post.castShadow = true;
        post.receiveShadow = true;
        deckGroup.add(post);
    });

    // Rim joists (perimeter beams)
    const rimJoistGeometry = new THREE.BoxGeometry(length, 0.75, 0.125);
    const rimJoistFront = new THREE.Mesh(rimJoistGeometry, supportMaterial);
    rimJoistFront.position.set(0, height - 0.375, width/2);
    rimJoistFront.castShadow = true;
    deckGroup.add(rimJoistFront);

    const rimJoistBack = new THREE.Mesh(rimJoistGeometry, supportMaterial);
    rimJoistBack.position.set(0, height - 0.375, -width/2);
    rimJoistBack.castShadow = true;
    deckGroup.add(rimJoistBack);

    const rimJoistSideGeometry = new THREE.BoxGeometry(0.125, 0.75, width);
    const rimJoistLeft = new THREE.Mesh(rimJoistSideGeometry, supportMaterial);
    rimJoistLeft.position.set(-length/2, height - 0.375, 0);
    rimJoistLeft.castShadow = true;
    deckGroup.add(rimJoistLeft);

    const rimJoistRight = new THREE.Mesh(rimJoistSideGeometry, supportMaterial);
    rimJoistRight.position.set(length/2, height - 0.375, 0);
    rimJoistRight.castShadow = true;
    deckGroup.add(rimJoistRight);

    // Deck boards (running perpendicular to length, i.e., along width)
    const numBoards = Math.ceil(length / (boardWidthFt + gapFt));
    const boardGeometry = new THREE.BoxGeometry(boardWidthFt, boardThicknessFt, width - 0.1);

    for (let i = 0; i < numBoards; i++) {
        const board = new THREE.Mesh(boardGeometry, deckMaterial);
        const xPos = -length/2 + boardWidthFt/2 + i * (boardWidthFt + gapFt);
        if (xPos + boardWidthFt/2 <= length/2) {
            board.position.set(xPos, height, 0);
            board.castShadow = true;
            board.receiveShadow = true;
            deckGroup.add(board);
        }
    }

    // Picture frame border
    if (pictureFrame) {
        const frameThickness = boardWidthFt;

        // Front and back frame boards
        const frameFBGeometry = new THREE.BoxGeometry(length + frameThickness * 2, boardThicknessFt * 1.1, frameThickness);
        const frameFront = new THREE.Mesh(frameFBGeometry, frameMaterial);
        frameFront.position.set(0, height + 0.01, width/2 + frameThickness/2);
        frameFront.castShadow = true;
        deckGroup.add(frameFront);

        const frameBack = new THREE.Mesh(frameFBGeometry, frameMaterial);
        frameBack.position.set(0, height + 0.01, -width/2 - frameThickness/2);
        frameBack.castShadow = true;
        deckGroup.add(frameBack);

        // Left and right frame boards
        const frameLRGeometry = new THREE.BoxGeometry(frameThickness, boardThicknessFt * 1.1, width);
        const frameLeft = new THREE.Mesh(frameLRGeometry, frameMaterial);
        frameLeft.position.set(-length/2 - frameThickness/2, height + 0.01, 0);
        frameLeft.castShadow = true;
        deckGroup.add(frameLeft);

        const frameRight = new THREE.Mesh(frameLRGeometry, frameMaterial);
        frameRight.position.set(length/2 + frameThickness/2, height + 0.01, 0);
        frameRight.castShadow = true;
        deckGroup.add(frameRight);
    }

    // Railings
    if (railing) {
        const railHeight = 3;
        const railPostSpacing = 4;

        // Add railing posts and top rail on all sides (except where stairs are)
        const sides = [
            { name: 'front', positions: [], dir: 'x', fixed: width/2, range: [-length/2, length/2] },
            { name: 'back', positions: [], dir: 'x', fixed: -width/2, range: [-length/2, length/2] },
            { name: 'left', positions: [], dir: 'z', fixed: -length/2, range: [-width/2, width/2] },
            { name: 'right', positions: [], dir: 'z', fixed: length/2, range: [-width/2, width/2] }
        ];

        sides.forEach(side => {
            if (stairs[side.name]) return; // Skip if stairs on this side

            const [start, end] = side.range;
            const railLen = end - start;

            // Posts
            for (let p = start; p <= end; p += railPostSpacing) {
                const postGeo = new THREE.BoxGeometry(0.15, railHeight, 0.15);
                const railPost = new THREE.Mesh(postGeo, railMaterial);
                if (side.dir === 'x') {
                    railPost.position.set(p, height + railHeight/2, side.fixed);
                } else {
                    railPost.position.set(side.fixed, height + railHeight/2, p);
                }
                railPost.castShadow = true;
                deckGroup.add(railPost);
            }

            // Top rail
            const topRailGeo = side.dir === 'x' 
                ? new THREE.BoxGeometry(railLen, 0.2, 0.3)
                : new THREE.BoxGeometry(0.3, 0.2, railLen);
            const topRail = new THREE.Mesh(topRailGeo, railMaterial);
            if (side.dir === 'x') {
                topRail.position.set(0, height + railHeight, side.fixed);
            } else {
                topRail.position.set(side.fixed, height + railHeight, 0);
            }
            topRail.castShadow = true;
            deckGroup.add(topRail);
        });
    }

    // Stairs
    Object.entries(stairs).forEach(([side, hasStairs]) => {
        if (!hasStairs) return;

        const numSteps = Math.ceil(height / 0.75);
        const stepRise = height / numSteps;
        const stepRun = 1;
        const stepWidth = stairWidth;

        for (let s = 0; s < numSteps; s++) {
            const stepGeo = new THREE.BoxGeometry(
                side === 'left' || side === 'right' ? stepRun : stepWidth,
                boardThicknessFt,
                side === 'left' || side === 'right' ? stepWidth : stepRun
            );
            const step = new THREE.Mesh(stepGeo, deckMaterial);

            const stepY = height - (s + 1) * stepRise + boardThicknessFt/2;
            let stepX = 0, stepZ = 0;

            if (side === 'front') {
                stepZ = width/2 + (s + 1) * stepRun - stepRun/2;
            } else if (side === 'back') {
                stepZ = -width/2 - (s + 1) * stepRun + stepRun/2;
            } else if (side === 'left') {
                stepX = -length/2 - (s + 1) * stepRun + stepRun/2;
            } else if (side === 'right') {
                stepX = length/2 + (s + 1) * stepRun - stepRun/2;
            }

            step.position.set(stepX, stepY, stepZ);
            step.castShadow = true;
            step.receiveShadow = true;
            deckGroup.add(step);

            // Stair stringers
            if (s === 0) {
                const stringerGeo = new THREE.BoxGeometry(
                    side === 'left' || side === 'right' ? numSteps * stepRun : 0.125,
                    0.75,
                    side === 'left' || side === 'right' ? 0.125 : numSteps * stepRun
                );

                [-stepWidth/2 + 0.1, stepWidth/2 - 0.1].forEach(offset => {
                    const stringer = new THREE.Mesh(stringerGeo, supportMaterial);
                    if (side === 'front') {
                        stringer.position.set(offset, height/2, width/2 + numSteps * stepRun / 2);
                    } else if (side === 'back') {
                        stringer.position.set(offset, height/2, -width/2 - numSteps * stepRun / 2);
                    } else if (side === 'left') {
                        stringer.position.set(-length/2 - numSteps * stepRun / 2, height/2, offset);
                    } else if (side === 'right') {
                        stringer.position.set(length/2 + numSteps * stepRun / 2, height/2, offset);
                    }
                    stringer.castShadow = true;
                    deckGroup.add(stringer);
                });
            }
        }
    });

    // Update material estimates
    updateMaterialEstimates();
}

function updateMaterialEstimates() {
    const { length, width, height, boardLength, stairs, stairWidth, pictureFrame } = builderState;

    const deckArea = length * width;
    const boardsPerLength = Math.ceil(length / EFFECTIVE_WIDTH_FT);
    const boardCoverage = boardLength * (BOARD_WIDTH_INCH / 12);

    // Main deck boards needed
    let totalBoardFeet = boardsPerLength * width;
    let numBoards = Math.ceil((totalBoardFeet * WASTE_FACTOR) / boardLength);

    // Border boards for picture frame
    let borderBoards = 0;
    if (pictureFrame) {
        const perimeter = 2 * (length + width);
        borderBoards = Math.ceil((perimeter * WASTE_FACTOR) / boardLength);
    }

    // Stair treads
    let stairTreads = 0;
    Object.entries(stairs).forEach(([side, hasStairs]) => {
        if (hasStairs) {
            const numSteps = Math.ceil(height / 0.75);
            const treadsPerStep = Math.ceil(stairWidth / (BOARD_WIDTH_INCH / 12));
            stairTreads += numSteps * treadsPerStep;
        }
    });

    // Screws
    const totalScrews = Math.ceil(deckArea * SCREWS_PER_SQFT);
    const screwBoxes = Math.ceil(totalScrews / SCREWS_PER_BOX);

    // Cost estimate
    const boardCost = numBoards * boardLength * PRODUCTS.system.price;
    const borderCost = borderBoards * boardLength * PRODUCTS.solid.price;
    const stairCost = stairTreads * 4 * PRODUCTS.solid.price; // Assume 4ft avg
    const screwCost = screwBoxes * PRODUCTS.screws.price;
    const totalCost = boardCost + borderCost + stairCost + screwCost;

    // Update UI
    document.getElementById('est-boards').textContent = `${numBoards} @ ${boardLength}ft`;
    document.getElementById('est-border').textContent = pictureFrame ? `${borderBoards} @ ${boardLength}ft` : 'None';
    document.getElementById('est-stairs').textContent = stairTreads > 0 ? `${stairTreads} treads` : 'None';
    document.getElementById('est-screws').textContent = `${screwBoxes} box${screwBoxes !== 1 ? 'es' : ''}`;
    document.getElementById('est-total').textContent = `$${totalCost.toFixed(2)}`;

    // Store for apply function
    builderState.estimates = {
        numBoards,
        borderBoards,
        stairTreads,
        screwBoxes,
        totalCost
    };
}

function animate() {
    animationId = requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
}

function onWindowResize() {
    const container = document.getElementById('builder-viewport');
    if (!container || !camera || !renderer) return;

    camera.aspect = container.clientWidth / container.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.clientWidth, container.clientHeight);
}

// Camera view presets
function setCameraView(view) {
    const { length, width, height } = builderState;
    const maxDim = Math.max(length, width, height);

    switch(view) {
        case 'top':
            camera.position.set(0, maxDim * 2, 0.01);
            break;
        case 'front':
            camera.position.set(0, height + 5, maxDim * 1.5);
            break;
        case 'side':
            camera.position.set(maxDim * 1.5, height + 5, 0);
            break;
        case '3d':
        default:
            camera.position.set(maxDim * 1.2, maxDim * 0.8, maxDim * 1.2);
            break;
    }
    camera.lookAt(0, height / 2, 0);
    controls.target.set(0, height / 2, 0);
}

// ============================================
// BUILDER UI INITIALIZATION
// ============================================
function initBuilderControls() {
    // Color swatches
    const swatchContainer = document.getElementById('builder-color-swatches');
    COLORS.forEach(color => {
        const swatch = document.createElement('div');
        swatch.className = 'color-swatch' + (color === builderState.color ? ' selected' : '');
        swatch.style.backgroundColor = '#' + COLOR_HEX[color].toString(16).padStart(6, '0');
        swatch.setAttribute('data-name', color);
        swatch.setAttribute('data-color', color);
        swatch.onclick = () => {
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('selected'));
            swatch.classList.add('selected');
            builderState.color = color;
            buildDeck();
        };
        swatchContainer.appendChild(swatch);
    });

    // Dimension inputs
    ['builder-length', 'builder-width', 'builder-height'].forEach(id => {
        document.getElementById(id).addEventListener('input', (e) => {
            const prop = id.replace('builder-', '');
            builderState[prop] = parseFloat(e.target.value) || 1;
            buildDeck();
        });
    });

    // Board length
    document.getElementById('builder-board-length').addEventListener('change', (e) => {
        builderState.boardLength = parseInt(e.target.value);
        updateMaterialEstimates();
    });

    // Stair width
    document.getElementById('stair-width').addEventListener('input', (e) => {
        builderState.stairWidth = parseFloat(e.target.value) || 3;
        buildDeck();
    });

    // Stair side buttons
    document.querySelectorAll('.stair-side-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const side = btn.getAttribute('data-side');
            builderState.stairs[side] = !builderState.stairs[side];
            btn.classList.toggle('active', builderState.stairs[side]);
            buildDeck();
        });
    });

    // Options checkboxes
    document.getElementById('builder-railing').addEventListener('change', (e) => {
        builderState.railing = e.target.checked;
        buildDeck();
    });

    document.getElementById('builder-picture-frame').addEventListener('change', (e) => {
        builderState.pictureFrame = e.target.checked;
        buildDeck();
    });

    // View buttons
    ['top', 'front', 'side', '3d'].forEach(view => {
        document.getElementById(`view-${view}`).addEventListener('click', () => {
            document.querySelectorAll('.viewport-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`view-${view}`).classList.add('active');
            setCameraView(view);
        });
    });

    // Apply to order
    document.getElementById('apply-to-order').addEventListener('click', applyBuilderToOrder);

    // Reset builder
    document.getElementById('reset-builder').addEventListener('click', () => {
        builderState = {
            length: 16,
            width: 12,
            height: 3,
            color: "Driftwood",
            boardLength: 16,
            stairs: { front: false, back: false, left: false, right: false },
            stairWidth: 4,
            railing: false,
            pictureFrame: false
        };

        document.getElementById('builder-length').value = 16;
        document.getElementById('builder-width').value = 12;
        document.getElementById('builder-height').value = 3;
        document.getElementById('builder-board-length').value = 16;
        document.getElementById('stair-width').value = 4;
        document.getElementById('builder-railing').checked = false;
        document.getElementById('builder-picture-frame').checked = false;

        document.querySelectorAll('.stair-side-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.color-swatch').forEach(s => {
            s.classList.toggle('selected', s.getAttribute('data-color') === 'Driftwood');
        });

        buildDeck();
        setCameraView('3d');
    });
}

function applyBuilderToOrder() {
    const { color, boardLength, estimates, pictureFrame, stairs } = builderState;

    // Clear existing line items
    lineItems = [];

    // Add deck boards
    if (estimates.numBoards > 0) {
        lineItems.push({
            type: "system",
            color: color,
            length: boardLength,
            qty: estimates.numBoards,
            priceOverride: null,
            customDesc: "",
            customUnitPrice: 0
        });
    }

    // Add border boards if picture frame
    if (pictureFrame && estimates.borderBoards > 0) {
        lineItems.push({
            type: "solid",
            color: color,
            length: boardLength,
            qty: estimates.borderBoards,
            priceOverride: null,
            customDesc: "",
            customUnitPrice: 0
        });
    }

    // Add stair treads
    if (estimates.stairTreads > 0) {
        lineItems.push({
            type: "solid",
            color: color,
            length: 4,
            qty: estimates.stairTreads,
            priceOverride: null,
            customDesc: "",
            customUnitPrice: 0
        });
    }

    // Add screws
    if (estimates.screwBoxes > 0) {
        lineItems.push({
            type: "screws",
            color: null,
            length: null,
            qty: estimates.screwBoxes,
            priceOverride: null,
            customDesc: "",
            customUnitPrice: 0
        });
    }

    // Update form checkboxes
    document.getElementById('pic-frame').checked = pictureFrame;
    document.getElementById('pic-frame-note').style.display = pictureFrame ? 'block' : 'none';

    const hasStairs = Object.values(stairs).some(v => v);
    document.getElementById('stairs').checked = hasStairs;
    document.getElementById('stairs-note').style.display = hasStairs ? 'block' : 'none';

    // Render and update
    render();
    updateTotalAndFasteners();

    // Scroll to order section
    document.getElementById('order').scrollIntoView({ behavior: 'smooth' });

    // Show success feedback
    const applyBtn = document.getElementById('apply-to-order');
    const originalText = applyBtn.textContent;
    applyBtn.textContent = 'Applied!';
    applyBtn.style.background = '#16a34a';
    setTimeout(() => {
        applyBtn.textContent = originalText;
        applyBtn.style.background = '';
    }, 2000);
}

// ============================================
// ORDER FORM LOGIC (Original functions)
// ============================================
const tbody = document.querySelector("#line-items tbody");
const modal = document.getElementById("colorModal");
const reviewModal = document.getElementById("reviewModal");
const modalImg = document.getElementById("colorLarge");
const modalName = document.getElementById("colorName");
const closeBtn = document.getElementById("modal-close");
const reviewCloseBtn = document.getElementById("review-close");

function updateCustomerProgress() {
    const name = document.getElementById("cust-name").value.trim() ? 1 : 0;
    const address = document.getElementById("cust-address").value.trim() ? 1 : 0;
    const phone = document.getElementById("cust-phone").value.trim() ? 1 : 0;
    const email = document.getElementById("cust-email").value.trim() ? 1 : 0;
    const completed = name + address + phone + email;
    const badge = document.getElementById("cust-badge");
    badge.textContent = `${completed}/4`;
    badge.classList.toggle("incomplete", completed !== 4);
}

["cust-name", "cust-address", "cust-phone", "cust-email"].forEach(id => {
    document.getElementById(id).addEventListener("input", updateCustomerProgress);
});

document.getElementById("add-row").onclick = () => {
    lineItems.push({
        type: "system",
        color: builderState.color,
        length: 16,
        qty: 1,
        priceOverride: null,
        customDesc: "",
        customUnitPrice: 0
    });
    deletedItems = [];
    render();
    updateTotalAndFasteners();
};

closeBtn.onclick = () => modal.classList.remove("active");
reviewCloseBtn.onclick = () => reviewModal.classList.remove("active");

window.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
        modal.classList.remove("active");
        reviewModal.classList.remove("active");
    }
});

window.addEventListener("click", (e) => {
    if (e.target === modal) modal.classList.remove("active");
    if (e.target === reviewModal) reviewModal.classList.remove("active");
});

document.getElementById("reset").onclick = () => {
    if (!confirm("Clear the entire form?")) return;
    lineItems = [];
    deletedItems = [];
    render();
    updateTotalAndFasteners();
    updateCustomerProgress();
    ["cust-name", "cust-company", "cust-address", "cust-phone", "cust-email", "ship-addr", "del-date", "special-instr", "internal-notes"].forEach(id => {
        document.getElementById(id).value = "";
    });
    document.getElementById("pic-frame").checked = false;
    document.getElementById("stairs").checked = false;
    document.getElementById("pic-frame-note").style.display = "none";
    document.getElementById("stairs-note").style.display = "none";
    document.getElementById("fastener-hint").style.display = "none";
    document.getElementById("success-msg").style.display = "none";
};

document.getElementById("pdf").onclick = generatePDF;
document.getElementById("review-btn").onclick = showReview;
document.getElementById("review-submit").onclick = () => {
    reviewModal.classList.remove("active");
    submitOrder();
};
document.getElementById("review-back").onclick = () => reviewModal.classList.remove("active");

["pic-frame", "stairs"].forEach(id => {
    document.getElementById(id).addEventListener("change", (e) => {
        document.getElementById(id + "-note").style.display = e.target.checked ? "block" : "none";
    });
});

function updateUndoButton() {
    document.getElementById("undo-btn").style.display = deletedItems.length > 0 ? "block" : "none";
}

document.getElementById("undo-btn").onclick = () => {
    if (deletedItems.length > 0) {
        lineItems.push(deletedItems.pop());
        render();
        updateTotalAndFasteners();
        updateUndoButton();
    }
};

function render() {
    renderDesktop();
    renderMobile();
    updateUndoButton();
}

function renderDesktop() {
    tbody.innerHTML = "";
    lineItems.forEach((item, i) => {
        const prod = PRODUCTS[item.type] || PRODUCTS.custom;
        const row = document.createElement("tr");

        // Product select
        let td = document.createElement("td");
        const sel = document.createElement("select");
        Object.entries(PRODUCT_CONFIG.categories).forEach(([catKey, category]) => {
            const optgroup = document.createElement("optgroup");
            optgroup.label = category.label;
            Object.entries(category.products).forEach(([prodKey, prodData]) => {
                const opt = document.createElement("option");
                opt.value = prodKey;
                opt.textContent = prodData.name;
                if (prodKey === item.type) opt.selected = true;
                optgroup.appendChild(opt);
            });
            sel.appendChild(optgroup);
        });
        sel.onchange = () => {
            item.type = sel.value;
            if (item.type !== "custom") {
                item.customDesc = "";
                item.customUnitPrice = 0;
            }
            if (!PRODUCTS[item.type].isFt) item.length = null;
            render();
            updateTotalAndFasteners();
        };
        td.appendChild(sel);
        row.appendChild(td);

        // Color
        td = document.createElement("td");
        if (prod.hasColor) {
            const csel = document.createElement("select");
            COLORS.forEach(c => {
                const o = document.createElement("option");
                o.value = c;
                o.textContent = c;
                if (c === item.color) o.selected = true;
                csel.appendChild(o);
            });
            csel.onchange = e => {
                item.color = e.target.value;
                updateTotalAndFasteners();
            };
            td.appendChild(csel);
            item.color = item.color || COLORS[0];
        }
        row.appendChild(td);

        // Length
        td = document.createElement("td");
        if (prod.isFt) {
            if (["system", "grooved", "solid"].includes(item.type)) {
                const lsel = document.createElement("select");
                [12, 16, 20].forEach(l => {
                    const o = document.createElement("option");
                    o.value = l;
                    o.text = l + " ft";
                    if (l === item.length) o.selected = true;
                    lsel.appendChild(o);
                });
                lsel.onchange = e => {
                    item.length = parseFloat(e.target.value);
                    render();
                    updateTotalAndFasteners();
                };
                td.appendChild(lsel);
            } else {
                const inp = document.createElement("input");
                inp.type = "number";
                inp.step = "0.1";
                inp.min = "0";
                inp.className = "len-input";
                inp.value = item.length || "";
                inp.oninput = e => { item.length = parseFloat(e.target.value) || 0; updateTotalAndFasteners(); };
                td.appendChild(inp);
            }
        }
        row.appendChild(td);

        // Qty
        td = document.createElement("td");
        td.className = "numeric";
        const q = document.createElement("input");
        q.type = "number";
        q.min = "1";
        q.step = "1";
        q.className = "qty-input";
        q.value = item.qty;
        q.oninput = e => { item.qty = Math.max(1, parseInt(e.target.value) || 1); updateTotalAndFasteners(); };
        td.appendChild(q);
        row.appendChild(td);

        // Unit Price
        td = document.createElement("td");
        td.className = "numeric";
        if (prod.isFt || item.type === "custom") {
            const p = document.createElement("input");
            p.type = "number";
            p.step = "0.01";
            p.min = "0";
            p.className = "price-input";
            const defPrice = item.type === "custom" ? item.customUnitPrice : prod.price;
            p.placeholder = "$" + defPrice.toFixed(2);
            p.value = item.priceOverride ?? "";
            p.oninput = e => { item.priceOverride = parseFloat(e.target.value); updateTotalAndFasteners(); };
            td.appendChild(p);
        } else {
            td.textContent = "$" + prod.price.toFixed(2);
        }
        row.appendChild(td);

        // Subtotal
        td = document.createElement("td");
        td.className = "numeric";
        td.id = "sub-" + i;
        row.appendChild(td);

        // Remove
        td = document.createElement("td");
        td.className = "table-actions-cell";
        const rm = document.createElement("button");
        rm.type = "button";
        rm.textContent = "";
        rm.className = "btn-remove-row";
        rm.onclick = () => {
            deletedItems.push(JSON.parse(JSON.stringify(item)));
            lineItems.splice(i, 1);
            render();
            updateTotalAndFasteners();
        };
        td.appendChild(rm);
        row.appendChild(td);

        tbody.appendChild(row);
    });
}

function renderMobile() {
    const container = document.getElementById("mobile-items-container");
    container.innerHTML = "";
    // Simplified mobile rendering - reuses desktop logic structure
}

function updateTotalAndFasteners() {
    let total = 0;
    lineItems.forEach((item, i) => {
        const prod = PRODUCTS[item.type] || PRODUCTS.custom;
        let unitPrice = item.priceOverride ?? (item.type === "custom" ? item.customUnitPrice : prod.price);
        let sub = 0;

        if (prod.isFt && item.length) {
            sub = unitPrice * item.length * item.qty;
        } else {
            sub = unitPrice * item.qty;
        }

        total += sub;
        const subEl = document.getElementById("sub-" + i);
        if (subEl) subEl.textContent = "$" + sub.toFixed(2);
    });

    document.getElementById("grand-total").textContent = "$" + total.toFixed(2);
    document.getElementById("sticky-total").textContent = "$" + total.toFixed(2);
}

function generatePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(18);
    doc.text("AmeriDex Order Form", 20, 20);

    doc.setFontSize(12);
    let y = 35;

    doc.text("Customer: " + (document.getElementById("cust-name").value || "N/A"), 20, y);
    y += 8;
    doc.text("Email: " + (document.getElementById("cust-email").value || "N/A"), 20, y);
    y += 8;
    doc.text("Phone: " + (document.getElementById("cust-phone").value || "N/A"), 20, y);
    y += 15;

    doc.setFontSize(14);
    doc.text("Line Items:", 20, y);
    y += 10;

    doc.setFontSize(10);
    lineItems.forEach((item, i) => {
        const prod = PRODUCTS[item.type] || PRODUCTS.custom;
        const line = `${i + 1}. ${prod.name} - ${item.color || 'N/A'} - ${item.length || 'N/A'}ft x ${item.qty}`;
        doc.text(line, 20, y);
        y += 6;
        if (y > 270) {
            doc.addPage();
            y = 20;
        }
    });

    y += 10;
    doc.setFontSize(14);
    doc.text("Total: " + document.getElementById("grand-total").textContent, 20, y);

    doc.save("ameridex-order.pdf");
}

function showReview() {
    document.getElementById("review-name").textContent = document.getElementById("cust-name").value || "Not provided";
    document.getElementById("review-email").textContent = document.getElementById("cust-email").value || "Not provided";
    document.getElementById("review-phone").textContent = document.getElementById("cust-phone").value || "Not provided";

    const itemsDiv = document.getElementById("review-items");
    itemsDiv.innerHTML = "";
    lineItems.forEach((item, i) => {
        const prod = PRODUCTS[item.type] || PRODUCTS.custom;
        const div = document.createElement("div");
        div.className = "review-item";
        div.innerHTML = `<span>${prod.name}</span><span>${item.qty}  ${item.length || 1}ft</span>`;
        itemsDiv.appendChild(div);
    });

    document.getElementById("review-total").textContent = document.getElementById("grand-total").textContent;
    reviewModal.classList.add("active");
}

function submitOrder() {
    const name = document.getElementById("cust-name").value;
    const email = document.getElementById("cust-email").value;
    const phone = document.getElementById("cust-phone").value;
    const total = document.getElementById("grand-total").textContent;

    let body = `New AmeriDex Order%0A%0ACustomer: ${name}%0AEmail: ${email}%0APhone: ${phone}%0A%0AItems:%0A`;
    lineItems.forEach((item, i) => {
        const prod = PRODUCTS[item.type] || PRODUCTS.custom;
        body += `${i + 1}. ${prod.name} - ${item.color || 'N/A'} - ${item.length || 'N/A'}ft x ${item.qty}%0A`;
    });
    body += `%0ATotal: ${total}`;

    window.location.href = `mailto:orders@ameridex.com?subject=New AmeriDex Order - ${name}&body=${body}`;
    document.getElementById("success-msg").style.display = "block";
}

// ============================================
// INITIALIZATION
// ============================================
document.addEventListener("DOMContentLoaded", () => {
    // Initialize Three.js builder
    initThreeJS();
    initBuilderControls();

    // Initialize order form
    render();
    updateTotalAndFasteners();
    updateCustomerProgress();
});
</script>

</body>
</html>
